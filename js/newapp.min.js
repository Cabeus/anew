function message(){$.ajax({type:"POST",url:ctx+"/message/list.json",success:function(e){$(".header_message").empty();var t=0;if($.each(e.list,function(e,a){var i;1==a.type?i="通知公告消息":2==a.type?i="任务消息":3==a.type?i="情况反映":4==a.type||8==a.type?i="求助消息":5==a.type?i="报警消息":6==a.type?i="居民信息更新":7==a.type&&(i="居民信息上报消息");var s;s=6!=a.type&&7!=a.type?$('<li><div class="col-xs-1"><span></span></div><div class="col-xs-11" onclick="detail('+a.type+","+a.entityId+","+a.id+');"><p>系统通知：'+i+"<span>"+new Date(a.createdAt).Format("yyyy-MM-dd hh:mm")+"</span></p><p>"+a.title+"</p></div></li>"):$('<li><div class="col-xs-1"><span></span></div><div class="col-xs-11" onclick="detail('+a.type+","+a.entityId+","+a.id+');"><p>系统通知：'+i+"<span>"+new Date(a.createdAt).Format("yyyy-MM-dd hh:mm")+"</span></p><p>"+a.title+"</p><p>姓名："+a.name+"   电话："+a.phone+"</p></div></li>"),$(".header_message").append(s),t++}),0==t){$(".header_message_num").hide();var a=$('<li id="remove" style="text-align: center">暂无内容</li>');$(".header_message").append(a),$(".empty-all").addClass("none").unbind("click")}else $(".header_message_num").show().html(t)}})}function detail(e,t,a){var i,s=window.location.href;1==e?i=ctx+"/info/informDetail/"+t+"?back=/info/notification":2==e?i=ctx+"/task/detail/"+t+"?back="+s.substring(ctx.length):3==e?i=ctx+"/feedback/detail/"+t+"?back="+s.substring(ctx.length):4==e||8==e?(i=ctx+"/rescueRequest/list",sessionStorage.setItem("key_id",t),sessionStorage.setItem("key_status",1)):5==e?i=ctx+"/benefit/web110":6==e&&(i=ctx+"/resident/list",$.ajax({type:"POST",url:ctx+"/resident/detail.json",data:{id:t},dataType:"JSON",async:!1,success:function(e){sessionStorage.identityNumber=e.object.identityNumber}})),$.ajax({type:"POST",url:ctx+"/message/save",data:{id:a},dataType:"JSON",success:function(t){7!=e?location.href=i:location.reload()}})}function noDataAlert(){layer.msg("该区域暂无数据",{time:2e3,icon:0},function(){})}function changeNewPassword(){$("#modal-change-password").modal("toggle"),$("#form-change-password input").val("")}function changeMyPassword(){var e=$("#form-change-password input[name='original']").val(),t=$("#form-change-password input[name='newPassword']").val(),a=$("#form-change-password input[name='repeat']").val();""!=e?""!=t?""!=a?e!=t?a==t?layer.confirm("确认变更吗？",{btn:["确定","取消"]},function(){var e=$("#form-change-password").serialize();$.ajax({type:"POST",url:ctx+"/admin/changePassword",data:e,success:function(e){"success"==e.msg?layer.msg("变更成功",{time:1e3,icon:1},function(){$("#modal-change-password").modal("toggle")}):layer.msg(e.msg,{time:1500,icon:0},function(){})}})},function(){}):layer.msg("两次输入的新密码不一致，请重新填写",{time:1500,icon:0},function(){}):layer.msg("新密码与原密码一致，请重新填写",{time:1500,icon:0},function(){}):layer.msg("请再次填写新密码",{time:1500,icon:0},function(){}):layer.msg("请填写新密码",{time:1500,icon:0},function(){}):layer.msg("请填写原密码",{time:1500,icon:0},function(){})}function serializeObject(e){let t={};return $.each(e.serializeArray(),function(e){t[this.name]?t[this.name]=t[this.name]+","+this.value:t[this.name]=this.value}),t}function setStorageTableParameter(e,t,a){let i={url:window.location.href.split("manager")[1],tableName:e,data:serializeObject($(t)),pageN:a};sessionStorage.setItem("table_parameter",JSON.stringify(i))}function setTableParameter(){let e=window.location.href.split("manager")[1],t=JSON.parse(sessionStorage.getItem("table_parameter"));void 0!=t&&(e!=t.url?sessionStorage.removeItem("table_parameter"):"/task/list"==t.url?"#table-task-list"==t.tableName?(console.log(t.data),$("#keyword1").val(t.data.title),selected("status1",t.data.status),$("#total-startDate").val(t.data.startDate),$("#total-endDate").val(t.data.endDate),$(".nav-tabs>li").eq(0).addClass("active").siblings("li").removeClass("active"),$(".tab-content>div").eq(0).addClass("active").siblings("div").removeClass("active"),initTaskTable({table:"#table-task-list",toolbar:"#toolbar-task-list",tag:"total"},t.pageN)):"#table-task-received"==t.tableName?(console.log(t.data),$("#keyword2").val(t.data.title),selected("status2",t.data.status),$("#received-startDate").val(t.data.startDate),$("#received-endDate").val(t.data.endDate),$(".nav-tabs li").eq(1).addClass("active").siblings("li").removeClass("active"),$(".tab-content>div").eq(1).addClass("active").siblings("div").removeClass("active"),initTaskTable({table:"#table-task-received",toolbar:"#toolbar-task-received",tag:"received"},t.pageN)):"#table-task-posted"==t.tableName&&(console.log(t.data),$("#keyword3").val(t.data.title),selected("status3",t.data.status),$("#posted-startDate").val(t.data.startDate),$("#posted-endDate").val(t.data.endDate),$(".nav-tabs li").eq(2).addClass("active").siblings("li").removeClass("active"),$(".tab-content>div").eq(2).addClass("active").siblings("div").removeClass("active"),initTaskTable({table:"#table-task-posted",toolbar:"#toolbar-task-posted",tag:"posted"},t.pageN)):"/info/local"==t.url?"#table-local"==t.tableName&&(console.log(t.data),$("input[name='title']").val(t.data.title),$("input[name='startDate']").val(t.data.startDate),$("input[name='endDate']").val(t.data.endDate)):"/info/recommend"==t.url?"#table-recommend"==t.tableName&&(console.log(t.data),$("#form_title").val(t.data.title),$("#form_startDate").val(t.data.startDate),$("#form_endDate").val(t.data.endDate)):"/info/database"==t.url?"##table-recommend"==t.tableName&&(console.log(t.data),$("#form_title").val(t.data.title),$("#form_startDate").val(t.data.startDate),$("#form_endDate").val(t.data.endDate)):"/feedback/listPage"==t.url?"#table1"==t.tableName?(console.log(t.data),$("#from-query input[name='title']").val(t.data.title),$("#from-query input[name='status']").val(t.data.status),$("#from-query input[name='region']").val(t.data.region),$("#from-query input[name='startDate']").val(t.data.startDate),$("#from-query input[name='endDate']").val(t.data.endDate),$(".nav-tabs li").eq(0).addClass("active").siblings("li").removeClass("active"),$(".tab-content>div").eq(0).addClass("active").siblings("div").removeClass("active")):"#table2"==t.tableName&&($("#from-query1 input[name='title']").val(t.data.title),$("#from-query1 input[name='status']").val(t.data.status),$("#from-query1 input[name='region']").val(t.data.region),$("#from-query1 input[name='startDate']").val(t.data.startDate),$("#from-query1 input[name='endDate']").val(t.data.endDate),$(".nav-tabs li").eq(1).addClass("active").siblings("li").removeClass("active"),$(".tab-content>div").eq(1).addClass("active").siblings("div").removeClass("active")):"/info/notification"==t.url&&("#table1"==t.tableName?(console.log(t.data),$("#from-query input[name='title']").val(t.data.title),$("#from-query input[name='startDate']").val(t.data.startDate),$("#from-query input[name='endDate']").val(t.data.endDate),$(".nav-tabs li").eq(0).addClass("active").siblings("li").removeClass("active"),$(".tab-content>div").eq(0).addClass("active").siblings("div").removeClass("active")):"#table2"==t.tableName&&($("#from-query1 input[name='title']").val(t.data.title),$("#from-query1 input[name='startDate']").val(t.data.startDate),$("#from-query1 input[name='endDate']").val(t.data.endDate),$(".nav-tabs li").eq(1).addClass("active").siblings("li").removeClass("active"),$(".tab-content>div").eq(1).addClass("active").siblings("div").removeClass("active"))),setTimeout(function(){sessionStorage.removeItem("table_parameter")},2e3))}function videoFlowOpen(e,t,a,i){$(".video-flow-mar").show(),$(".video-flow-txt").empty(),$("#get-face").show(),$("#stop-face").hide(),$(".face-list-box").hide(),$(".face-img").empty();$(".video-flow-con").append('<video id="video-flow" class="video-js" width="890" height="520" style="width: 890px;height: 520px"><source src="rtmp://219.139.44.9:51554/liveonly/cam32845_url2_copy" type="rtmp/flv"></video>'),loggerAdd(i,0),$.ajax({type:"POST",url:ctx+"/camera/getRTMP",data:{userAccount:e,userPassword:t,cameraId:a,decodeType:"copy",isPublic:1,url:window.location.href},dataType:"json",success:function(e){if(console.log(e.url),e.url){$(".video-flow-txt").text(e.name);var t=e.url;$("#video-flow-url").val(t),sessionStorage.videoId=i,videojs("video-flow").load(),videojs("video-flow").src(t),videojs("video-flow",{},function(){this.play()})}else layer.msg("未获取到可用端口",{time:1e3,icon:0},function(){})}})}function videoFlowClose(){loggerAdd(sessionStorage.videoId,1),videojs("video-flow").dispose(),$(".video-flow-mar").hide()}function videoNetPluginSDKOpen(e,t,a){loggerAdd(a,0),videoFlagTag==e?playVideo(t):(layer.msg("加载视频中，请稍等...",{time:2e3,icon:0},function(){}),setTimeout(function(){localLogin2(e),videoFlagTag=e,playVideo(t)},200))}function videoNetPluginSDKClose(){loggerAdd(sessionStorage.videoId,1),$(".video-box").css({width:"0px",height:"0px"}),$("#playerContainer2").css({width:"1px",height:"1px"}),stopVideo1()}function loggerAdd(e,t){let a;0==t?a=0:1==t&&(a=sessionStorage.loggerId),$.ajax({type:"post",url:ctx+"/logger/add",dataType:"json",data:{videoId:e,url:window.location.href,loggerId:a},success:function(e){console.log(e.loggerId),sessionStorage.loggerId=e.loggerId},error:function(e){console.log(e)}})}function getFace(){console.log("开始人脸识别"),$("#get-face").hide(),$("#stop-face").show();var e=$("#video-flow-url").val();videojs("video-flow").pause();$(".face-img").empty().append('<div class="animation-face"></div>');let t=Date.parse(new Date);$.ajax({type:"POST",url:ctx+"/camera/face/detect",dataType:"json",data:{rmtp:e,videoId:sessionStorage.videoId,url:window.location.href},async:!0,success:function(e){let a=Date.parse(new Date)-t;a>1e3&&(a=0),setTimeout(function(){let t=e.data.image;$(".face-list-box").show();let a='<img src="'+t+'">';$(".face-img").empty().append(a),$(".face-list-box").empty();let i=e.data.faces;if(0==i.length){let e='<div style="width: 100%;height: 100%;display: flex"><img style="display:block;margin: auto" src="'+ctx+'/static/anew/img/no-face.png"></div>';$(".face-list-box").append(e)}for(let e=0;e<i.length;e++){let t=i[e];if(t.person){let a='<div id = "face'+e+'" class="face-item" onClick = "clickFaceItem(this)"><div class="face-hicon"><img src="'+t.person.icon+'"><div class="face-data-degrees">置信度'+t.person.match_rate+'</div></div><div class="face-data"><div>姓名：'+t.person.name+"</div><div>性别："+t.person.gender+"</div><div>户籍地："+t.person.householdAddr+"</div></div></div>";$(".face-list-box").append(a)}else{let e='<div style="width: 100%;height: 100%;display: flex"><img style="display:block;margin: auto" src="'+ctx+'/static/anew/img/no-face.png"></div>';$(".face-list-box").append(e)}let a='<div id="face'+e+'-frame" class="face-frame" style="top:'+2*t.face_rectangle.top+"px;left: "+2*t.face_rectangle.left+"px;width: "+2*t.face_rectangle.width+"px;height: "+2*t.face_rectangle.height+'px;"><img src="'+ctx+'/static/anew/img/face-win.png"></div>';$(".face-img").append(a)}},a)}})}function clickFaceItem(e){let t=$(e).attr("id");$(".face-frame").empty().append('<img src="'+ctx+'/static/anew/img/face-win.png" alt="">'),$("#"+t+"-frame").empty().append('<img src="'+ctx+'/static/anew/img/face-win-active.png" alt="">')}function stopFace(){console.log("取消人脸识别"),$("#get-face").show(),$("#stop-face").hide(),$(".face-list-box").hide(),$(".face-img").empty(),videojs("video-flow").play()}function selected(e,t){$('option[value="'+t+'"]',$("#"+e)).prop("selected",!0),$("#"+e).multiselect("refresh")}function Map(){this.keys=new Array,this.data=new Object,this.put=function(e,t){null==this.data[e]&&this.keys.push(e),this.data[e]=t},this.get=function(e){return this.data[e]},this.remove=function(e){this.keys.remove(e),this.data[e]=null},this.each=function(e){if("function"==typeof e)for(var t=this.keys.length,a=0;a<t;a++){var i=this.keys[a];e(i,this.data[i],a)}},this.entrys=function(){for(var e=this.keys.length,t=new Array(e),a=0;a<e;a++)t[a]={key:this.keys[a],value:this.data[a]};return t},this.isEmpty=function(){return 0==this.keys.length},this.size=function(){return this.keys.length},this.toString=function(){for(var e="{",t=0;t<this.keys.length;t++,e+=","){var a=this.keys[t];e+=a+"="+this.data[a]}return e+="}"}}$(document).ready(function(){var e=$(window).height()-88;$(".aside").height(e),$(".main-content").height(e-20),$(".main-content-two").height(e-64)}),$(window).resize(function(){var e=$(window).height()-88;$(".aside").height(e),$(".main-content").height(e-20),$(".main-content-two").height(e-64)}),$(".single-dropdown").mouseenter(function(){$(this).children(".single-ul").slideDown(0)}),$(".single-dropdown").mouseleave(function(){$(this).children(".single-ul").slideUp(0)}),$(document).ready(function(){let e=window.location.href;$(".navigation-links").each(function(){-1!=this.href.indexOf("/index/backtrack?")&&$(this).attr("href",$(this).attr("href")+e)})}),$(document).ready(function(){var e=window.location.href;-1!=e.indexOf("/index/loginMap")?$(".nav-center ul li.li-home").addClass("active"):-1!=e.indexOf("/index/login")||-1!=e.indexOf("/residentStatistics/home?")?$(".nav-center ul li.li-statistics").addClass("active"):-1!=e.indexOf("/user/list")||-1!=e.indexOf("/admin/list")||-1!=e.indexOf("/index/command")||$(".nav-center ul li.li-wisdom").addClass("active"),-1==e.indexOf("/user/list")&&-1==e.indexOf("/admin/list")||$(".setup").addClass("active"),-1!=e.indexOf("/index/login")?$(".two-menu ul li").eq(0).addClass("active"):-1!=e.indexOf("/residentStatistics/home?")&&$(".two-menu ul li").eq(1).addClass("active")}),$(document).ready(function(){var e=window.location.href;$("#nav-functions a").each(function(){$(this).attr("href")==e?-1!=e.indexOf("/admin/coming")?$(this).parent().addClass("active"):$(this).parent().addClass("active").parent().attr("style","display: block;").parent().addClass("open"):-1!=$(this).attr("href").indexOf(e.split("back=")[1])?$(this).parent().addClass("active").parent().attr("style","display: block;").parent().addClass("open"):-1!=$(this).attr("href").indexOf(e.split("Member")[0])&&$(this).parent().addClass("active").parent().attr("style","display: block;").parent().addClass("open")})}),$(document).ready(function(){var e=window.location.href;adminIsTrue?($("#backjump").show(),$("#backjump").attr("href",ctx+"/index/backtrack?back="+e),console.log(ctx+"/index/backtrack?back="+e),console.log($("#backjump").attr("href"))):$("#backjump").hide()}),$(".message").mouseenter(function(e){$(".message-box").show(),$(".message").addClass("active")}),$(".message").mouseleave(function(e){$(".message-box").hide(),$(".message").removeClass("active")}),$(".empty-all").click(function(){layer.confirm("确认全部清空吗？",{btn:["确定","取消"]},function(){$.ajax({type:"POST",url:ctx+"/message/delAll",success:function(e){tmp=$('<li id="remove" style="text-align: center">暂无内容</li>'),$(".header_message").append(tmp),layer.msg("消息已全部清空",{time:1e3,icon:1})}}),$(".header_message").empty(),$(".header_message_num").hide(),$(".empty-all").addClass("none").unbind("click")},function(){})}),$(document).ready(function(){message()}),$(".common").mouseenter(function(e){$(".common-box").show(),$(".common").addClass("active")}),$(".common").mouseleave(function(e){$(".common-box").hide(),$(".common").removeClass("active")});var localeDaterangepicker={format:"YYYY-MM-DD",separator:" -222 ",applyLabel:"确定",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间'",customRangeLabel:"自定义",weekLabel:"W",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1};Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};